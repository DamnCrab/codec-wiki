---
title: ZIP压缩格式
sidebar_position: 1
---

# ZIP压缩格式

:::caution 待审核
本条目内容可能存在准确性不足的情况，正在等待进一步审核以评估信息质量。
:::

ZIP是一种支持无损数据压缩的归档文件格式。ZIP文件可包含使用ZIP规范中任意一种压缩算法处理的一个或多个文件/目录。其中最常用的算法是DEFLATE，该算法也应用于[gzip](../data/gzip.mdx)和[PNG](../images/PNG.mdx)格式。

Deflate算法结合了LZ77无损编码与霍夫曼编码：先通过LZ77识别数据中的重复模式并消除冗余，随后使用霍夫曼编码为LZ77识别出的高频模式分配更短的比特值。

ZIP归档中的文件采用独立压缩机制，因此可以单独提取已有文件或添加新文件，而无需对整个归档进行解压缩/再压缩操作。

ZIP格式以近乎普适的兼容性著称。"传统ZIP"（ZIP规范中的压缩方法8）将压缩包大小限制在4GB以内，但多数ZIP压缩工具会采用Deflate64™（ZIP规范中的压缩级别9）来突破此限制。虽然ZIP在性能上与[gzip](../data/gzip.mdx)相当，但已陆续被[bzip2](../data/bzip2.mdx)、[XZ](../data/xz.mdx)、[7-zip](../data/7z.mdx)、[brotli](../data/brotli.mdx)（部分场景）和[Zstandard](../data/zstd.mdx)等格式算法所超越。

## 格式解析

DEFLATE是基于LZ77的压缩算法，通过识别输入数据中的重复字节序列并用指向先前出现的短引用来替代。同时结合霍夫曼编码，根据符号出现频率分配变长码值。DEFLATE对每个数据块提供两种压缩模式："静态"或"动态"霍夫曼编码块。静态模式采用预定义的固定霍夫曼码表，动态模式则随压缩数据动态生成并传输霍夫曼码表。

ZIP文件结构包含四个核心组成部分：
1. 本地文件头 - 存储压缩文件的名称、尺寸、CRC-32校验值、压缩方法等元数据
2. 中央目录文件头 - 除包含本地文件头信息外，还记录各文件在ZIP中的偏移量
3. 中央目录结束记录 - 标记文件结尾并记载中央目录的尺寸与条目数
4. 数据描述符（可选） - 补充存储CRC-32校验值、压缩前后尺寸等数据信息

ZIP还支持其他压缩方法如Deflate64™、BZIP2、LZMA和[Zstandard](../data/zstd.mdx)，但这些方法可能引发兼容性问题。该格式同时支持未压缩数据存储，并提供两种加密方案：不安全的传统ZipCrypto加密与未标准化的强加密（采用多种算法实现）。

ZIP文件通过高效表征冗余数据缩减存储空间，并能将多文件整合为单一归档。其最大优势在于无可比拟的普及度，同时能完整保留文件名、路径、日期等元数据。但传统ZIP（非ZIP64）存在单文件4GB、总条目65,535的限制，且多数实现不支持符号链接/硬链接。

各平台均提供便捷的ZIP支持：macOS Finder内置"压缩"选项，Linux桌面环境提供GUI工具，Windows用户则常用7-zip工具进行压缩（注意区分[7-zip格式](../data/7z.mdx)）。

## 历史沿革

ZIP格式由Phil Katz开发为开放规范，其PKZIP实现采用共享软件模式。存在受限版本的ZIP规范，应用于Java .jar包、Microsoft Office文档(.docx等)、开放文档格式(.odt等)及EPUB电子书等场景。

1990年左右Info-ZIP项目诞生，成功提供了兼容PKZIP的自由版本工具，极大推动了ZIP普及。同期[gzip](../data/gzip.mdx)格式基于Info-ZIP的Deflate代码开发，旨在替代使用专利LZW算法的Unix compress工具。

与`.tar`不同，`.zip`文件末尾的中央目录实现了随机访问能力，而`.tar`必须完全解压才能构建目录结构。虽然`.tar.gz`能利用跨文件冗余实现更高压缩率（成为Unix系统最流行的归档格式），但ZIP的独立压缩特性在某些场景更具优势。现代替代方案如[XZ](../data/xz.mdx)、[bzip2](../data/bzip2.mdx)等提供了更好的压缩效率。

## 编码实践

#### Linux & macOS

推荐使用7-zip的DEFLATE实现进行高效ZIP压缩，其官网宣称对ZIP/GZIP格式的压缩率比PKZip/WinZip高2-10%。可通过[7-zip下载页](https://www.7-zip.org/download.html)获取CLI工具：
- [Linux x86_64](https://www.7-zip.org/a/7z2301-linux-x64.tar.xz)
- [macOS通用版](https://www.7-zip.org/a/7z2301-mac.tar.xz)

安装后注意区分动态(`7zz`)与静态(`7zzs`)二进制文件，建议将所选版本复制到`/usr/local/bin`以便全局调用。

- 单线程最低压缩级别：
```bash
7zz a -bso0 -tzip -mmt1 -mx1 "输出.zip" "输入"
```

- 八线程最高压缩级别：
```bash
7zz a -bso0 -tzip -mmt8 -mx9 "输出.zip" "输入"
```

#### Windows

（待补充）

## 结论

ZIP当前唯一显著优势在于兼容性。虽然相比7z/XZ格式因其简单性在编解码速度上有优势，但Zstandard在这两方面表现更优。在Web内容传输领域，现代浏览器均已支持Brotli压缩，这为传统类ZIP的Web压缩技术提供了更优替代方案。