---
title: x265
sidebar_position: 2
---

# x265

x265是由MulticoreWare开发的[H.265/HEVC](../video/HEVC.mdx)视频编码软件库及命令行工具，采用C++与x86汇编编写，于2013年发布。

默认配置下，x265通过应用模糊滤镜针对低比特率内容进行了优化，但同样能通过调整实现高保真编码并表现优异。

目前不建议使用x265进行无损编码。在此领域，x264速度明显更快且效率无损。

# FFmpeg集成

x265可通过`libx265`在FFmpeg中使用，运行`ffmpeg -h encoder=libx265`可检查是否支持该编码器。

# 安装指南

**推荐预编译版本：**
- http://msystem.waw.pl/x265/

# 核心参数详解

本节将概述x265中控制输出与质量的关键参数。参数以独立x265二进制格式列出，但所有参数均可通过`-x265-params pass=1`等形式在FFmpeg中使用。

## 预设模式

`--preset`

x265的预设系统可便捷控制编码耗时与压缩强度，包含以下等级：
ultrafast, superfast, faster, fast, medium（默认）, slow, slower, veryslow及placebo

通常预设越靠左（越快），编码效率越低；反之则效率越高。建议在使用本页其他参数前，先根据硬件条件选择可接受的最慢预设作为性能基准。

极端预设不推荐使用：ultrafast编码质量极不稳定，此时x264更具优势；而placebo因特殊原因（后文详述）实际表现略逊于veryslow。

## 码率控制

### `--CRF`

恒定速率因子（CRF）是x265中最接近质量滑块的参数，数值越小质量越高。虽然CRF能提供良好的整体一致性，但具体质量仍受片源和设置影响。更慢的预设通常能在相同CRF下获得更高品质。

以下为不同分辨率下的推荐CRF实验值（仅供参考）：

| 质量等级      	| 720p 	| 1080p 	| 4K   	|
|--------------	|------	|-------	|------	|
| 视觉无损      	| 14   	| 16    	| 18   	|
| 高质量        	| 18   	| 22    	| 24   	|
| 中等质量      	| 24   	| 26    	| 28   	|
| 低质量        	| 28   	| 30    	| 32   	|

x265设计上CRF增减6约对应文件大小减半/翻倍。CRF因其质量一致性和编码效率成为首选码控方式。

### `--bitrate`

该参数用于指定单次编码的平均比特率（ABR）或二次编码的可变比特率（VBR）目标。除非特殊需求，否则不推荐使用——其效率低于CRF且无法保持稳定质量。

## 多线程优化

`--wpp`与`--frame-threads`

### `--wpp`

波前并行处理（WPP）是x265默认的并行编码技术，仅损失1-3%效率即可提升3-5倍线程利用率。除非使用Av1an等追求极限效率的工具，否则建议保持开启（默认）。

WPP将视频帧分割为行单元，每行比上行延迟2个编码单元（CU）。这种设计允许编码器在H.265规范范围内进行参考，但因非单线程特性会损失少量优化机会。

### `--frame-threads`

帧级多线程在WPP基础上实现帧间并行编码，带来额外5-7倍加速，代价是1-3%效率损失。最新x265 4.1版本中，2线程与最大16线程的效率差异已可忽略。

## B帧控制

`--bframes`, `--b-adapt`, `--bframe-bias`及`--b-pyramid`

B帧作为双向预测帧，能同时参考前后帧，是最高效的帧类型，但压缩率较高可能导致画质模糊。

### `--bframes`

控制最大连续B帧数量（上限16）。数值越大编码越慢但效率越高。在CRF≤18的高保真编码中，超过8-12个B帧可能损害细节。动画等平面内容可尝试增加2个B帧，极致压缩可设为16。

### `--b-adapt`

B帧决策模式：
| 模式 | 特性                   |
|------|------------------------|
| 1    | 固定模式               |
| 2    | 轻量前瞻               |
| 3    | 维特比网格（默认）     |

推荐始终使用模式3，其在可忽略的速度损失下实现最优B帧布局。

### `--bframe-bias`

控制B帧使用倾向。默认值0已适配多数场景，高保真编码可微调以平衡时空细节。

### `--b-pyramid`

决定B帧是否可作为参考帧。默认开启，高保真场景可尝试关闭。

## 修复滤波

`--sao`系列与`--deblock`

### SAO滤波

样本自适应偏移（SAO）可消除块效应与振铃伪影，但可能损失皮肤纹理等细节。CRF≥20时建议保持默认开启。高质量编码（CRF16以下）可尝试`--limit-sao`或`--no-sao`。

### 去块滤波

文档描述晦涩的去块滤波可减轻块效应，高强度可能造成模糊。默认值适用于多数场景，动画可设为`--deblock -1:-1`，实拍内容可尝试`--deblock -2:-2`以保留更多噪点细节。

## 心理视觉优化

`--psy-rd`、`--psy-rdoq`、`--aq-mode`及`--aq-strength`

详细原理请参阅[心理视觉优化](../introduction/psychovisual.mdx)专题。

### 感知优化对

`--psy-rd`通过高频信息加权保留细节，`--psy-rdoq`通过量化系数调整保持视觉能量。两者高度依赖片源，除非深度测试否则建议保持默认。

### 自适应量化

AQ模式表：
| 模式 | 特性                         |
|------|------------------------------|
| 1    | 基础AQ                       |
| 2    | 自动方差AQ（默认）           |
| 3    | 暗场偏重AQ                   |
| 4    | 边缘信息AQ                   |

推荐默认模式2，模式3需验证实际收益。强度参数`--aq-strength`对动画类平面内容可降至0.7-0.8。

## CU树技术

`--cutree`与`--no-cutree`

CU树（类似x264的MB树）通过跟踪帧间参考关系实现时域量化优化。早期版本可能存在过度模糊问题，但现代实现已显著改进。任何禁用建议均需提供实证依据。