---
title: QOI图像格式
sidebar_position: 8
---

# QOI图像格式

QOI（Quite OK Image Format）是一种旨在提供简单、快速且高效无损图像压缩的格式。该格式设计初衷是实现简单，在提供比广泛使用但更复杂的[PNG](../images/PNG.mdx)格式更好压缩率的同时，实现更快的编码解码速度。

## 特性清单

是否无损？*是*

是否有损？*否*

支持位深：
*每通道8位*

支持HDR/广色域？*否*

支持动画？*否*

支持透明通道？*是*

支持渐进式解码？*否*

免专利费？*是*

## 格式解析

QOI压缩基于一种利用图像空间冗余性的快速简单算法。该算法结合了行程编码（RLE）、小型查找表、差分编码和全彩像素存储技术来实现高效压缩。根据算法决策，每个数据块（像素）可能占用1到5字节。

QOI格式支持3或4通道（RGB或RGBA）及每通道8位的图像。支持两种色彩空间：线性RGB和带线性Alpha的sRGB。这些设定不影响像素编码方式。

QOI格式包含以下数据块类型：

1. **`QOI_OP_RGB`**：完整RGB像素值，红绿蓝通道各占1字节（8位）。RGB图像的Alpha通道固定为255且永不改变。

2. **`QOI_OP_RGBA`**：完整RGBA像素值，红绿蓝及Alpha通道各占1字节。

3. **`QOI_OP_DIFF`**：存储当前像素与前一像素在RGB通道上的差值，每个通道使用2位存储。差值以2为偏置并循环处理（如1减2结果为255）。Alpha通道保持不变。

4. **`QOI_OP_LUMA`**：使用6位存储绿色通道与前一像素的差值，红蓝通道则相对于绿色差值各用4位存储。这种设计能更高效编码微小颜色变化。Alpha通道保持不变。

5. **`QOI_OP_RUN`**：最简单类型，编码与前一像素相同的连续像素。行程长度使用6位存储（偏置-1），支持1到62像素的连续区间。

6. **`QOI_OP_INDEX`**：通过简单哈希算法引用滚动数组中64个历史像素值。当新像素匹配已有哈希值时，存储对应索引值。

QOI格式还包含14字节的文件头（存储图像尺寸、色彩空间和通道位深信息）以及8字节的文件结束标记。

### 性能基准

QOI作者使用C语言实现版本[`qoibench.c`](https://github.com/phoboslab/qoi/blob/master/qoibench.c)，在2,879张截图、图标、照片和纹理的测试集上（[数据源](https://qoiformat.org/benchmark/qoi_benchmark_suite.tar)）对比了libpng和`stbi_image_write`的性能表现：

| **库名称** | **解码耗时(ms)** | **编码耗时(ms)** | **解码速度(MP/s)**  | **编码速度(MP/s)**  | **体积(kb)** | **压缩率** |
|---------|-----------|-----------|--------------|--------------|---------|-------:|
| `libpng`| 7.0       | 83.8      | 66.56        | 5.54         | 398     | 24.2%  |
| `stbi`  | 7.0       | 60.5      | 66.63        | 7.67         | 561     | 34.2%  |
| `qoi`   | 2.1       | 2.9       | 226.03       | 161.99       | 463     | 28.2%  |

测试结果表明QOI在编解码速度上显著优于libpng和`stb_image_write`，平均压缩率也优于libpng。

### 优势特点

QOI的核心优势包括：

- 极简设计：[规范文档](https://qoiformat.org/qoi-specification.pdf)仅一页篇幅
- 超快的编码解码速度
- 数据块字节对齐，支持逐字节流式解码
- 对多数图像类型的压缩率优于PNG
- 支持透明通道
- 免专利费（CC0协议）、开源且易于集成

### 局限性

- 仅支持每通道8位（不支持更高位深）
- 不适用于高频噪声图像或空间冗余极低的图像
- 缺少渐进加载、隔行扫描或自定义元数据等高级特性

尽管存在限制，QOI在需要简单快速且良好压缩率的场景中，为PNG提供了极具竞争力的替代方案。虽然当前支持度有限，但由于格式简单易实现，开发者可以快速为其应用添加QOI支持，其生态正在迅速发展。