"use strict";(self.webpackChunkav_1_wiki=self.webpackChunkav_1_wiki||[]).push([[9060],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>f});var n=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var s=n.createContext({}),u=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},d=function(e){var t=u(e.components);return n.createElement(s.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,l=e.originalType,s=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),c=u(a),p=o,f=c["".concat(s,".").concat(p)]||c[p]||m[p]||l;return a?n.createElement(f,r(r({ref:t},d),{},{components:a})):n.createElement(f,r({ref:t},d))}));function f(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var l=a.length,r=new Array(l);r[0]=p;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i[c]="string"==typeof e?e:o,r[1]=i;for(var u=2;u<l;u++)r[u]=a[u];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}p.displayName="MDXCreateElement"},4901:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>m,frontMatter:()=>l,metadata:()=>i,toc:()=>u});var n=a(7462),o=(a(7294),a(3905));const l={title:"aomenc"},r="aomenc",i={unversionedId:"encoders/aomenc",id:"encoders/aomenc",title:"aomenc",description:"aomenc or libaom is a command line application for encoding AV1 written in C and Assembly developed by AOMedia, which is also the reference encoder for AV1.",source:"@site/docs/encoders/aomenc.md",sourceDirName:"encoders",slug:"/encoders/aomenc",permalink:"/av1-wiki.github.io/docs/encoders/aomenc",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/encoders/aomenc.md",tags:[],version:"current",frontMatter:{title:"aomenc"},sidebar:"tutorialSidebar",previous:{title:"VVenC",permalink:"/av1-wiki.github.io/docs/encoders/VVenC"},next:{title:"rav1e",permalink:"/av1-wiki.github.io/docs/encoders/rav1e"}},s={},u=[{value:"Choosing forks",id:"choosing-forks",level:2},{value:"FFmpeg",id:"ffmpeg",level:2},{value:"Installation",id:"installation",level:2},{value:"Microsoft Windows",id:"microsoft-windows",level:3},{value:"MacOS",id:"macos",level:3},{value:"Linux",id:"linux",level:3},{value:"Usage",id:"usage",level:2}],d={toc:u},c="wrapper";function m(e){let{components:t,...a}=e;return(0,o.kt)(c,(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"aomenc"},"aomenc"),(0,o.kt)("p",null,"aomenc or ",(0,o.kt)("strong",{parentName:"p"},"libaom")," is a command line application for encoding AV1 written in C and Assembly developed by AOMedia, which is also the reference encoder for AV1."),(0,o.kt)("h2",{id:"choosing-forks"},"Choosing forks"),(0,o.kt)("p",null,'Mainline aomenc is unfortunately not good, as it suffers from bad defaults, heavy focus on PSNR which reduces its psycho-visual capabilities, clickbait (or should I call, "usebait") settings that does X instead of Y, among others. Fortunately two forks were created to combat these, first there\'s ',(0,o.kt)("a",{parentName:"p",href:"https://github.com/BlueSwordM/aom-av1-psy"},"aom-av1-psy")," which was created by BlueSwordM. But it is no longer maintained as of 13th January 2023, another fork called ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/Clybius/aom-av1-lavish"},"aom-av1-lavish")," was then created off of it by Clybius to continue on the legacy."),(0,o.kt)("p",null,"These forks fix up the horrid decisions made by the original AOM devs and most importantly introduce new parameters and tunes to help fine tune (haha get it? sorry ill see myself out) the encoder more. TL;DR use ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/Clybius/aom-av1-lavish"},"aom-av1-lavish")),(0,o.kt)("h2",{id:"ffmpeg"},"FFmpeg"),(0,o.kt)("p",null,"!!! warning Mainline aomenc\nSince FFmpeg encoder libraries come as the most default, barebones as possible (Therefore mainline aomenc), it is not recommended to use it. Unless you build it yourself.\n!!!"),(0,o.kt)("p",null,"aomenc is available in FFmpeg via ",(0,o.kt)("inlineCode",{parentName:"p"},"libaom-av1"),", check if you have it by running ",(0,o.kt)("inlineCode",{parentName:"p"},"ffmpeg -h encoder=libaom-av1")," which would display the following output (As of 2023-05-09):\n==- CLI output"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"Encoder libaom-av1 [libaom AV1]:\n    General capabilities: dr1 delay threads \n    Threading capabilities: other\n    Supported pixel formats: yuv420p yuv422p yuv444p gbrp yuv420p10le yuv422p10le yuv444p10le yuv420p12le yuv422p12le yuv444p12le gbrp10le gbrp12le gray gray10le gray12le\nlibaom-av1 encoder AVOptions:\n  -cpu-used          <int>        E..V....... Quality/Speed ratio modifier (from 0 to 8) (default 1)\n  -auto-alt-ref      <int>        E..V....... Enable use of alternate reference frames (2-pass only) (from -1 to 2) (default -1)\n  -lag-in-frames     <int>        E..V....... Number of frames to look ahead at for alternate reference frame selection (from -1 to INT_MAX) (default -1)\n  -arnr-max-frames   <int>        E..V....... altref noise reduction max frame count (from -1 to INT_MAX) (default -1)\n  -arnr-strength     <int>        E..V....... altref noise reduction filter strength (from -1 to 6) (default -1)\n  -aq-mode           <int>        E..V....... adaptive quantization mode (from -1 to 4) (default -1)\n     none            0            E..V....... Aq not used\n     variance        1            E..V....... Variance based Aq\n     complexity      2            E..V....... Complexity based Aq\n     cyclic          3            E..V....... Cyclic Refresh Aq\n  -error-resilience  <flags>      E..V....... Error resilience configuration (default 0)\n     default                      E..V....... Improve resiliency against losses of whole frames\n  -crf               <int>        E..V....... Select the quality for constant quality mode (from -1 to 63) (default -1)\n  -static-thresh     <int>        E..V....... A change threshold on blocks below which they will be skipped by the encoder (from 0 to INT_MAX) (default 0)\n  -drop-threshold    <int>        E..V....... Frame drop threshold (from INT_MIN to INT_MAX) (default 0)\n  -denoise-noise-level <int>        E..V....... Amount of noise to be removed (from -1 to INT_MAX) (default -1)\n  -denoise-block-size <int>        E..V....... Denoise block size  (from -1 to INT_MAX) (default -1)\n  -undershoot-pct    <int>        E..V....... Datarate undershoot (min) target (%) (from -1 to 100) (default -1)\n  -overshoot-pct     <int>        E..V....... Datarate overshoot (max) target (%) (from -1 to 1000) (default -1)\n  -minsection-pct    <int>        E..V....... GOP min bitrate (% of target) (from -1 to 100) (default -1)\n  -maxsection-pct    <int>        E..V....... GOP max bitrate (% of target) (from -1 to 5000) (default -1)\n  -frame-parallel    <boolean>    E..V....... Enable frame parallel decodability features (default auto)\n  -tiles             <image_size> E..V....... Tile columns x rows\n  -tile-columns      <int>        E..V....... Log2 of number of tile columns to use (from -1 to 6) (default -1)\n  -tile-rows         <int>        E..V....... Log2 of number of tile rows to use (from -1 to 6) (default -1)\n  -row-mt            <boolean>    E..V....... Enable row based multi-threading (default auto)\n  -enable-cdef       <boolean>    E..V....... Enable CDEF filtering (default auto)\n  -enable-global-motion <boolean>    E..V....... Enable global motion (default auto)\n  -enable-intrabc    <boolean>    E..V....... Enable intra block copy prediction mode (default auto)\n  -enable-restoration <boolean>    E..V....... Enable Loop Restoration filtering (default auto)\n  -usage             <int>        E..V....... Quality and compression efficiency vs speed trade-off (from 0 to INT_MAX) (default good)\n     good            0            E..V....... Good quality\n     realtime        1            E..V....... Realtime encoding\n     allintra        2            E..V....... All Intra encoding\n  -tune              <int>        E..V....... The metric that the encoder tunes for. Automatically chosen by the encoder by default (from -1 to 1) (default -1)\n     psnr            0            E..V.......\n     ssim            1            E..V.......\n  -still-picture     <boolean>    E..V....... Encode in single frame mode (typically used for still AVIF images). (default false)\n  -enable-rect-partitions <boolean>    E..V....... Enable rectangular partitions (default auto)\n  -enable-1to4-partitions <boolean>    E..V....... Enable 1:4/4:1 partitions (default auto)\n  -enable-ab-partitions <boolean>    E..V....... Enable ab shape partitions (default auto)\n  -enable-angle-delta <boolean>    E..V....... Enable angle delta intra prediction (default auto)\n  -enable-cfl-intra  <boolean>    E..V....... Enable chroma predicted from luma intra prediction (default auto)\n  -enable-filter-intra <boolean>    E..V....... Enable filter intra predictor (default auto)\n  -enable-intra-edge-filter <boolean>    E..V....... Enable intra edge filter (default auto)\n  -enable-smooth-intra <boolean>    E..V....... Enable smooth intra prediction mode (default auto)\n  -enable-paeth-intra <boolean>    E..V....... Enable paeth predictor in intra prediction (default auto)\n  -enable-palette    <boolean>    E..V....... Enable palette prediction mode (default auto)\n  -enable-flip-idtx  <boolean>    E..V....... Enable extended transform type (default auto)\n  -enable-tx64       <boolean>    E..V....... Enable 64-pt transform (default auto)\n  -reduced-tx-type-set <boolean>    E..V....... Use reduced set of transform types (default auto)\n  -use-intra-dct-only <boolean>    E..V....... Use DCT only for INTRA modes (default auto)\n  -use-inter-dct-only <boolean>    E..V....... Use DCT only for INTER modes (default auto)\n  -use-intra-default-tx-only <boolean>    E..V....... Use default-transform only for INTRA modes (default auto)\n  -enable-ref-frame-mvs <boolean>    E..V....... Enable temporal mv prediction (default auto)\n  -enable-reduced-reference-set <boolean>    E..V....... Use reduced set of single and compound references (default auto)\n  -enable-obmc       <boolean>    E..V....... Enable obmc (default auto)\n  -enable-dual-filter <boolean>    E..V....... Enable dual filter (default auto)\n  -enable-diff-wtd-comp <boolean>    E..V....... Enable difference-weighted compound (default auto)\n  -enable-dist-wtd-comp <boolean>    E..V....... Enable distance-weighted compound (default auto)\n  -enable-onesided-comp <boolean>    E..V....... Enable one sided compound (default auto)\n  -enable-interinter-wedge <boolean>    E..V....... Enable interinter wedge compound (default auto)\n  -enable-interintra-wedge <boolean>    E..V....... Enable interintra wedge compound (default auto)\n  -enable-masked-comp <boolean>    E..V....... Enable masked compound (default auto)\n  -enable-interintra-comp <boolean>    E..V....... Enable interintra compound (default auto)\n  -enable-smooth-interintra <boolean>    E..V....... Enable smooth interintra mode (default auto)\n  -aom-params        <dictionary> E..V....... Set libaom options using a :-separated list of key=value pairs\n")),(0,o.kt)("p",null,"==="),(0,o.kt)("p",null,"You can input non-FFmpeg standard aomenc parameters via ",(0,o.kt)("inlineCode",{parentName:"p"},"-aom-params"),". Please keep in mind that unless you built FFmpeg yourself."),(0,o.kt)("h2",{id:"installation"},"Installation"),(0,o.kt)("h3",{id:"microsoft-windows"},"Microsoft Windows"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"The Easy Way:")," Download the pre-built versions, which can be found below:"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://cdn.discordapp.com/attachments/1042536514783023124/1069212358989336626/aomenc-skylake.7z"},"Skylake build")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://cdn.discordapp.com/attachments/1042536514783023124/1069198775899398234/aomenc.7z"},"Zen 2 build"),"\n!!! warning Updating and compiling\nJoin the ",(0,o.kt)("a",{parentName:"p",href:"https://discord.gg/vpREHAvYvh"},"AV1 Discord server")," and head to #community-builds for updated versions, you can opt to compile it yourself with those custom (Butteraugli, VMAF) tunes but its a huge PITA on Windows.\n!!!"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"The Compiling Route:")),(0,o.kt)("p",null,"Tools needed: Visual Studio (Any), Git, CMake, nasm (or yasm for 32bit)"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'git clone https://github.com/Clybius/aom-av1-lavish -b Endless_Merging\ncd aom-av1-lavish && mkdir -p aom_build && cd aom_build\ncmake .. -DBUILD_SHARED_LIBS=0 -DENABLE_DOCS=0 -DCONFIG_TUNE_BUTTERAUGLI=0 -DCONFIG_TUNE_VMAF=0 -DCONFIG_AV1_DECODER=0 -DENABLE_TESTS=0 -DCMAKE_BUILD_TYPE=Release -DCMAKE_CXX_FLAGS="-flto -O3 -march=native" -DCMAKE_C_FLAGS="-flto -O3 -march=native -pipe -fno-plt" -DCMAKE_LD_FLAGS="-flto -O3 -march=native"\ncmake --build . -j 16\n')),(0,o.kt)("p",null,'Built files should be in the "Debug" folder'),(0,o.kt)("h3",{id:"macos"},"MacOS"),(0,o.kt)("p",null,"Sorry, I don't use or have Mac. You're on your own."),(0,o.kt)("h3",{id:"linux"},"Linux"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"The Easy Way:"),"\nInstall ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/gianni-rosato/aviator"},"Aviator"),", it is currently only available as a ",(0,o.kt)("a",{parentName:"p",href:"https://beta.flathub.org/apps/net.natesales.Aviator"},"Flatpak"),"\nor\nInstall ",(0,o.kt)("a",{parentName:"p",href:"https://giannirosato.com/blog/post/aviator-1/"},"rAV1ator"),", basically same thing but av1an + rav1e\n",(0,o.kt)("strong",{parentName:"p"},"Keep in mind Aviator ships with SVT-AV1 and rAV1ator with rav1e instead of Aomenc/AOM-AV1, which I will not be covering here")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"The compiling route:"),"\nYou know what to do, so I'll just list the things you'll need: ",(0,o.kt)("inlineCode",{parentName:"p"},"Vapoursynth, Av1an, FFmpeg, mkvtoolnix, Git, Perl, CMake, Ninja, Meson, Nasm, Rust (USE RUSTUP ON DEBIAN/UBUNTU), Highway (libhwy)")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Compiling aom-av1-lavish (Basic, recommended for beginners)")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'git clone https://github.com/Clybius/aom-av1-lavish -b Endless_Merging\ncd aom-av1-lavish && mkdir -p aom_build && cd aom_build\ncmake .. -DBUILD_SHARED_LIBS=0 -DENABLE_DOCS=0 -DCONFIG_TUNE_BUTTERAUGLI=0 -DCONFIG_TUNE_VMAF=0 -DCONFIG_AV1_DECODER=0 -DENABLE_TESTS=0 -DCMAKE_BUILD_TYPE=Release -DCMAKE_CXX_FLAGS="-flto -O3 -march=native" -DCMAKE_C_FLAGS="-flto -O3 -march=native -pipe -fno-plt" -DCMAKE_LD_FLAGS="-flto -O3 -march=native"\nmake -j$(nproc)\nsudo make install\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Compiling aom-av1-lavish (Full)")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"VMAF shenanigans")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'git clone https://github.com/Netflix/vmaf\ncd vmaf/libvmaf && mkdir build && cd build\nmeson .. --buildtype=release --default-library=both -Db_lto=true -Dc_args="-march=native" -Dcpp_args="-march=native" && ninja\nsudo ninja install\n')),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"Copy VMAF models (Assuming user cloned in $HOME)")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"sudo cp -r /home/$USER/vmaf/model /usr/share\n")),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"Install libjxl libraries")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'git clone https://github.com/libjxl/libjxl && cd libjxl && chmod +x deps.sh && ./deps.sh\nmkdir build && cd build\ncmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_CXX_FLAGS="-O3 -march=native" -DCMAKE_C_FLAGS="-O3 -march=native" -DJPEGXL_ENABLE_PLUGINS=ON -DJPEGXL_ENABLE_DEVTOOLS=ON -DJPEGXL_WARNINGS_AS_ERRORS=OFF -DJPEGXL_ENABLE_SJPEG=OFF  .. && cmake --build . -- -j$(nproc)\nsudo make install\n')),(0,o.kt)("ol",{start:4},(0,o.kt)("li",{parentName:"ol"},"Install aom-av1-lavish")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'git clone https://github.com/Clybius/aom-av1-lavish -b Endless_Merging\ncd aom-av1-lavish && mkdir -p aom_build && cd aom_build\ncmake .. -DBUILD_SHARED_LIBS=0 -DENABLE_DOCS=0 -DCONFIG_TUNE_BUTTERAUGLI=1 -DCONFIG_TUNE_VMAF=1 -DCONFIG_AV1_DECODER=0 -DENABLE_TESTS=0 -DCMAKE_BUILD_TYPE=Release -DCMAKE_CXX_FLAGS="-flto -O3 -march=native" -DCMAKE_C_FLAGS="-flto -O3 -march=native -pipe -fno-plt" -DCMAKE_LD_FLAGS="-flto -O3 -march=native"\nmake -j$(nproc)\nsudo make install\n')),(0,o.kt)("p",null,"!!!info Branches\n",(0,o.kt)("inlineCode",{parentName:"p"},"Endless_Butter")," used to be bleeding edge but now it's been taken over by ",(0,o.kt)("inlineCode",{parentName:"p"},"Endless_Merging"),", be sure to check the Github page on which is more updated!\n!!!\n","\xa0","\xa0"),(0,o.kt)("h2",{id:"usage"},"Usage"),(0,o.kt)("p",null,"the"))}m.isMDXComponent=!0}}]);