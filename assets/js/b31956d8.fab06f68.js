"use strict";(self.webpackChunkcodec_wiki=self.webpackChunkcodec_wiki||[]).push([[3599],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>h});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},u="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),u=p(n),m=r,h=u["".concat(l,".").concat(m)]||u[m]||c[m]||o;return n?a.createElement(h,i(i({ref:t},d),{},{components:n})):a.createElement(h,i({ref:t},d))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[u]="string"==typeof e?e:r,i[1]=s;for(var p=2;p<o;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},8958:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var a=n(7462),r=(n(7294),n(3905));const o={title:"x264",sidebar_position:1},i="x264",s={unversionedId:"encoders/x264",id:"encoders/x264",title:"x264",description:"x264 is a software library and command line application for encoding H.264 / AVC developed by VideoLAN, the people behind the ever-popular VLC Media Player and released under GNU GPL. It is written in C and Assembly with almost two decades worth of development and threading optimizations which makes it the fastest software video encoder available, which also happens to be extremely popular.",source:"@site/docs/encoders/x264.md",sourceDirName:"encoders",slug:"/encoders/x264",permalink:"/docs/encoders/x264",draft:!1,editUrl:"https://github.com/av1-community-contributors/codec-wiki/tree/main/docs/encoders/x264.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"x264",sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Site Optimization",permalink:"/docs/images/site-optimization"},next:{title:"x265",permalink:"/docs/encoders/x265"}},l={},p=[{value:"FFmpeg",id:"ffmpeg",level:2},{value:"Installation",id:"installation",level:2},{value:"Usage",id:"usage",level:2},{value:"Recommendations",id:"recommendations",level:2},{value:"Lowering presets",id:"lowering-presets",level:3},{value:"Increase threads",id:"increase-threads",level:3},{value:"Open GOP",id:"open-gop",level:3},{value:"AQ Mode 3",id:"aq-mode-3",level:3},{value:"Increasing reference frames",id:"increasing-reference-frames",level:3},{value:"Tips and tricks",id:"tips-and-tricks",level:2}],d={toc:p},u="wrapper";function c(e){let{components:t,...n}=e;return(0,r.kt)(u,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"x264"},"x264"),(0,r.kt)("p",null,"x264 is a software library and command line application for encoding H.264 / AVC developed by VideoLAN, the people behind the ever-popular VLC Media Player and released under GNU GPL. It is written in C and Assembly with almost two decades worth of development and threading optimizations which makes it the fastest software video encoder available, which also happens to be extremely popular."),(0,r.kt)("p",null,"x264 has great fine detail retention which makes it perfect for high fidelity content."),(0,r.kt)("h2",{id:"ffmpeg"},"FFmpeg"),(0,r.kt)("p",null,"x264 is available in FFmpeg via ",(0,r.kt)("inlineCode",{parentName:"p"},"libx264"),", to check if you have it, run ",(0,r.kt)("inlineCode",{parentName:"p"},"ffmpeg -h encoder=libx264"),". You can input non-FFmpeg standard x264 parameters via ",(0,r.kt)("inlineCode",{parentName:"p"},"-x264-params"),"."),(0,r.kt)("h2",{id:"installation"},"Installation"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Pre-built binary ","[Recommended]",":")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://code.videolan.org/videolan/x264"},"https://code.videolan.org/videolan/x264"))),(0,r.kt)("p",null,"Choose your operating system there, or you can try using your package manager."),(0,r.kt)("h2",{id:"usage"},"Usage"),(0,r.kt)("p",null,"x264 has been praised for its simple, easy-to-use, and no fuss settings. Here are some examples:"),(0,r.kt)("p",null,"Simple Y4M input with CRF 20 and raw ",(0,r.kt)("inlineCode",{parentName:"p"},"264")," bitstream output:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"x264 --crf 20 -o output.264 input.y4m\n")),(0,r.kt)("p",null,"Preset slow, CRF 20, Y4M input:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"x264 --preset slow --crf 20 -o output.264 input.y4m\n")),(0,r.kt)("p",null,"FFmpeg piping:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ffmpeg -v error -i input.mkv -f yuv4mpegpipe -strict -1 - | x264 --preset slow --crf 20 --demux y4m - -o output.264\n")),(0,r.kt)("p",null,"FFmpeg piping with MKV output:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ffmpeg -v error -i input.mkv -f yuv4mpegpipe -strict -1 - | x264 --preset slow --crf 20 --demux y4m - -o output.mkv\n")),(0,r.kt)("admonition",{title:"Output Containers",type:"note"},(0,r.kt)("p",{parentName:"admonition"},"x264 can output ",(0,r.kt)("inlineCode",{parentName:"p"},"264"),", MKV, FLV (Flash Video), and MP4 (If compiled with GPAC or L-SMASH support).")),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"x264 will use Haali Matroska Muxer for MKV outputs, which has seeking issues. It is recommended to remux back using FFmpeg or mkvmerge/MKVToolNix.")),(0,r.kt)("h2",{id:"recommendations"},"Recommendations"),(0,r.kt)("p",null,'As x264 is made to "just work", so there is little to modify in terms of advanced parameters. The general guideline is to just make it as slow as you can bear it.'),(0,r.kt)("h3",{id:"lowering-presets"},"Lowering presets"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"--preset veryslow")),(0,r.kt)("p",null,"The most obvious option, set the preset to the slowest bearable option. You can use ",(0,r.kt)("inlineCode",{parentName:"p"},"placebo")," if you have a beefy CPU."),(0,r.kt)("h3",{id:"increase-threads"},"Increase threads"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"--threads X")),(0,r.kt)("p",null,"By default, x264 uses 12 threads. If you have more than 12, increase it to your CPU's maximum and x264 will completely saturate it."),(0,r.kt)("h3",{id:"open-gop"},"Open GOP"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"--open-gop")),(0,r.kt)("p",null,"Enables Open GOP (Group of Pictures), where each GOP can ",(0,r.kt)("a",{parentName:"p",href:"https://ottverse.com/closed-gop-open-gop-idr/"},"reference one another"),", thus improving compression with little speed loss. For unknown reasons it is disabled by default in x264."),(0,r.kt)("h3",{id:"aq-mode-3"},"AQ Mode 3"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"--aq-mode 3")),(0,r.kt)("p",null,"In short, will make x264 bias to dark areas and spend more bitrate there, thus dark scenes will look less bad. Basically no speed loss."),(0,r.kt)("h3",{id:"increasing-reference-frames"},"Increasing reference frames"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"--bframes 8 --ref 12")),(0,r.kt)("p",null,"These parameters are responsible for the amount of reference frames x264 will use for compression, the more the better. Maximum of 16, will definitely increase compute time the higher you go."),(0,r.kt)("h2",{id:"tips-and-tricks"},"Tips and tricks"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"x264 is a great alternative when you need to encode lossless video outside of using something like FFV1, utvideo, etc. To do that just encode with ",(0,r.kt)("inlineCode",{parentName:"li"},"--qp 0"),", using slower presets will decrease the size even further.")),(0,r.kt)("admonition",{title:"Why not CRF 0?",type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Because CRF automatically adjusts the ",(0,r.kt)("strong",{parentName:"p"},"quantization parameters")," to achieve the desired quality. QP in the other hand, which stands for ",(0,r.kt)("strong",{parentName:"p"},"Quantization Parameter"),", you get full control over the quality you'll get. In this case, all-intra or lossless.")))}c.isMDXComponent=!0}}]);